
<dom-module id="sign-up">
	<style>
		.field {
			@apply(--layout-horizontal);
		}

		h2 {
			margin-right: 20px;
		}
	</style>
	<template>
		<firebase-auth id="firebaseLogin" status-known="{{statusKnown}}" location="https://flamingo365.firebaseio.com" provider="password" on-error="errorHandler" on-user-created="userSuccessHandler" on-password-changed="userSuccessHandler" on-password-reset="userSuccessHandler" on-user-removed="userSuccessHandler"></firebase-auth>
		<div class="field">
			<h2>Gender</h2>
			<paper-radio-group id="rgGender" selected="male">
				<paper-radio-button name="male">Male</paper-radio-button>
				<paper-radio-button name="female">Female</paper-radio-button>
			</paper-radio-group>
		</div>
		<div class="field">
			<h2>Name</h2>
			<paper-input id="piUserName" value="{{username}}" label="ex) William" required auto-validate></paper-input>
		</div>
		<div class="field">
			<h2>E-mail</h2>
			<paper-input id="piEmail" type="email" value="{{email}}" label="fly@flamingofly.com" error-message="check again email form" required auto-validate></paper-input>
		</div>
		<div class="field">
			<h2>Password</h2>
			<paper-input id="piPassword" value="{{password}}" type="password" label="ex) 12345678" minlength="6" required auto-validate error-message="minimum 6 characters" char-counter></paper-input>
		</div>			
		<div class="field">
			<h2>Password Check</h2>
			<paper-input id="piPasswordCheck" value="{{passwordCheck}}" type="password" minlength="6" required auto-validate error-message="minimum 6 characters" char-counter></paper-input>
		</div>			
		<div class="field">
			<h2>Birth Date</h2>
			<paper-input id="ipBirth" type="date" value="{{birth}}" required auto-validate></paper-input>
		</div>
		<!-- <div class="field">
			<h2>Nationality</h2>
			<paper-input id="piNationality"></paper-input>
		</div> -->
		<div class="field">
			<h2>Phone Number</h2>
			<paper-input id="piCountryCode" type="number" label="country code (ex:82)" value="{{countryCode}}" required auto-validate></paper-input>
			<paper-input id="piPhone" type="number" value="{{phone}}" required auto-validate></paper-input>
		</div>
		<div class="field">
			<span>By continuing, you're confiming that you're read and agree to our terms and conditions and privacy policy</span>
		</div>
		<paper-button id="btnSignup" on-tap="signup" disabled$="{{checkData(username, email, password, passwordCheck, birth, countryCode, phone)}}" raised class="colorful ripple">Sign Up</paper-button>
	</template>
</dom-module>
<script>
	Polymer({
		is: "sign-up",

		properties: {
			message: {
	        	type: String,
	        	value: ''
	      	},
			
			gender: {
				type: String,
				value: 'male'
			},

			username: {
	        	type: String,
	        	value: ''
	      	},

			email: {
	        	type: String,
	        	value: ''
	      	},	      	

			password: {
	        	type: String,
	        	value: ''
	      	},

	      	passwordCheck: {
	        	type: String,
	        	value: ''
	      	},

	      	birth: {
	      		type: String,
	      		value: ''
	      	},

	      	countryCode: Number,

	      	phone: Number
		},

		ready: function() {

		},

		initialize: function() {
			this.username = "";
			this.email = "";
			this.password = "";
			this.passwordCheck = "";
			this.birth = "";
			this.countryCode = 0;
			this.phone = 0;
		},

		checkData: function(username, email, password, passwordCheck, birth, countryCode, phone) {			
			if(this.username==''){
				return true;
			}
			if(this.password=='' || this.passwordCheck==''){
				return true;
			}
			if(this.password!==this.passwordCheck){
				return true;
			}

			if(this.birth==''){
				return true;
			}
			if(this.countryCode==null || this.countryCode==0){
				return true;
			}
			if(this.phone==null || this.phone==0){
				return true;
			}

			return false;
		},

		errorHandler: function(e) {
	      this.message = 'Error: ' + e.detail.message;
	      console.log(this.message);
	    },

	    userSuccessHandler: function(e) {
	      this.message = e.type + ' success!';
	      console.log(this.message);
	    },

		signup: function() {
			if(this.email=='' || this.password==''){
				return;
			}

			this.$.firebaseLogin.createUser(this.email, this.password);
			var gender = this.$.rgGender.selected;			

			var data = {
				provider: 'password',
				gender: gender,
				username: this.username,
				email: this.email,				
				birth: this.birth,
				countryCode: this.countryCode,
				phone: this.phone,
				created_at: new Date().getTime(),
				status: 0
			};

			var ref = new Firebase("https://flamingo365.firebaseio.com/users");	    
			ref.push(data);	  			

			this.fire('show-dialog', {content: "Sign-up has completed.", url: "/register"});

			this.initialize();
		}
	});
</script>