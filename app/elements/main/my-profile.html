
<dom-module id="my-profile">
	<style>
		hr {
			border: 0;
    		height: 1px;
    		background: rgb(200,200,200);
    	}

		.field {
			@apply(--layout-horizontal);
			text-align: center;
		}		

		h2 {
			margin-right: 20px;
			font-size: 16px;
			font-weight: normal;
		}

		.userbox {
			text-align: center;
			margin-top: 15px
			margin-bottom: 15px;
		}

		.userbox .pictureField {
			margin-top: 15px;
		}

		.userbox .infos { 
			margin-top: 10px;
			@apply(--layout-horizontal);
			@apply(--layout-center-justified);
		}

		.infoWrapper {
			text-align: center;
			margin-top: 10px;
		}

		.infoWrapper .title {
			font-size: 20px;
			color: rgb(253,68,19);	
		}

		paper-checkbox{
	        --paper-checkbox-checked-color: var(--paper-orange-500);
	        --paper-checkbox-checked-ink-color: var(--paper-orange-500);
	        --paper-checkbox-unchecked-color: var(--paper-orange-900);
	        --paper-checkbox-unchecked-ink-color: var(--paper-orange-900);
	        --paper-checkbox-label-color: rgb(126,126,126);
	        margin-left: 10px;
	        margin-right: 10px;
	        margin-bottom: 10px;
	    }

	    paper-checkbox:checked {
	    	--paper-checkbox-label-color: rgb(253,68,19);
	    }

      #btnUpdate {
      	margin-top: 30px;
      	margin: 0 auto;	      	
      }
	</style>
	<template>		
		<firebase-document
	     	location="{{userTarget}}"
	     	data="{{userData}}"
	     	>
	     </firebase-document>
		
		<div class="userbox">
			<div class="pictureField">				
				<iron-image src="{{userData.picture}}" style="width:100px; height:100px;"></iron-image>			
			</div>

			<div class="infos">
				<iron-icon class="icGender" src="{{_computeUserGender(userData.gender)}}"></iron-icon>
				<div class="username">{{userData.username}}</div>
				<div class="age">, [[_computeUserAge(userData.birth)]]</div>
			</div>
		</div>

		<hr />
				
		<div class="infoWrapper vertical-section">
			<div class="title">My information</div>
			<div class="prefWrapper">
				<h2>Preference</h2>
				<div class="content">
					<template is="dom-repeat" items="{{prefItems}}">
						<paper-checkbox data-index$="{{index}}" on-iron-change="changeStatusPref" noink checked$="{{item.checked}}">{{item.name}}</paper-checkbox>
					</template>					
				</div>
			</div>
			<div class="lifeWrapper">
				<h2>Life style</h2>
				<div class="content">
					<template is="dom-repeat" items="{{lifeItems}}">
						<paper-checkbox data-index$="{{index}}" on-iron-change="changeStatusLife" noink checked$="{{item.checked}}">{{item.name}}</paper-checkbox>
					</template>					
				</div>
			</div>
		</div>		

		<div class="field">
			<paper-button id="btnUpdate" on-tap="updateProfile" raised class="colorful ripple">Update</paper-button>
		</div>
	</template>
</dom-module>
<script>
	Polymer({
		is: "my-profile",

		properties: {					
			userid: String,				

	      	userTarget: {
				type: String,
				computed: '_computeUserTarget(userid)'
			},

			userData: {
				type: Object,
				observer: '_userDataChanged'				
			},

			prefItems: Array,

			lifeItems: Array
		},

		ready: function() {
			this.prefItems = [
				{name:'culinary', checked: false}, {name:'holiday', checked: false}, {name:'romantic', checked: false}, {name:'luxury', checked: false}, {name:'city tour', checked: false}, {name:'roadtrip', checked: false}, {name:'activity', checked: false}, {name:'beach', checked: false},
				{name:'chiling', checked: false}, {name:'cultural', checked: false}, {name:'rest', checked: false}, {name:'adventure', checked: false}, {name:'health', checked: false}
			];

			this.lifeItems = [
				{name:'swimming', checked: false}, {name:'surfing', checked: false}, {name:'skiing', checked: false}, {name:'diving', checked: false}, {name:'hiking', checked: false}, {name:'fishing', checked: false}, {name:'bicycling', checked: false}, {name:'shopping', checked: false},
				{name:'movie', checked: false}, {name:'artist', checked: false}, {name:'music', checked: false}, {name:'cooking', checked: false}, {name:'photography', checked: false}
			];
		},

		_userDataChanged: function() {
			if(this.userData!=null){
				this.prefItems=JSON.parse(this.userData.strPref);
				this.lifeItems=JSON.parse(this.userData.strLife);
			}
		},

		// _defaultUserId: function(user) {
		// 	if(user!=null){
		// 		console.log("user:"+user.uid);
		// 		return user.uid;
		// 	}
		// },

		_computeUserTarget: function(userid) {			
			if(userid!=""){					
				return "https://flamingo365.firebaseio.com/users/"+userid;
			}			
		},

		_computeUserGender: function(gender) {
			if(gender==="male"){
				return "../../images/main/male_imae.png";
			} else {
				return "../../images/main/female_imae.png";
			}
		},

		_computeUserAge: function(birth) {
			if(birth==null){
				return "";
			}
			
			var date = new Date(birth);
			var ageDate = new Date(Date.now()-date.getTime());
			return Math.abs(ageDate.getFullYear()-1970);
		},

		changeStatusPref: function(e) {
			var dataIndex = e.currentTarget.getAttribute("data-index");
			var checked = e.currentTarget.getAttribute("checked");
			if(checked!=null){
				checked = true;
			} else {
				checked = false;
			}
			
			if(this.prefItems[dataIndex]!=undefined){
				this.prefItems[dataIndex].checked = checked;
			}			
		},

		changeStatusLife: function(e) {
			var dataIndex = e.currentTarget.getAttribute("data-index");
			var checked = e.currentTarget.getAttribute("checked");
			if(checked!=null){
				checked = true;
			} else {
				checked = false;
			}
			
			if(this.lifeItems[dataIndex]!=undefined){
				this.lifeItems[dataIndex].checked = checked;
			}			
		},

		updateProfile: function() {			
						
			var strPref = JSON.stringify(this.prefItems);						
			var strLife = JSON.stringify(this.lifeItems);
			

			if(strPref==null || strLife==null){
				return;
			}

			var ref = new Firebase("https://flamingo365.firebaseio.com/users");	    
			ref.child(this.userid).update({
				"strPref": strPref,
				"strLife": strLife
			});					
			
			alert("Update Complete!!");
		}
	});
</script>